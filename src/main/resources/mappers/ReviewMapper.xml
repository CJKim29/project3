<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.githrd.project3.dao.ReviewMapper">

  <!-- 전체조회 -->
  <select id="selectReviewList" resultType="review">
		SELECT r.review_idx, r.review_title, r.review_content, r.mem_nickname, r.review_regdate, rs.review_score_point, m.mem_filename
    FROM review r
    JOIN member m ON r.mem_idx = m.mem_idx
    LEFT JOIN review_score rs ON r.review_idx = rs.review_idx
    WHERE r.performance_idx = #{performance_idx}
    ORDER BY r.review_idx desc;
  </select>

  <!-- 리뷰 작성(insert) -->
  <!-- review_idx 받아오기 위해 useGenerateKeys와 keyProperty사용 -->
  <insert id="review_insert" parameterType="review"  useGeneratedKeys="true" keyProperty="review_idx">
     insert into review values(null,
                               #{ mem_idx },
                               #{ performance_idx },
                               #{ review_title },
                               #{ review_content },
                               #{ mem_nickname },
                               now(),
                               default
                               );
    
  </insert>
  <!-- 평점 insert -->
  <insert id="insertReviewScore" parameterType="review_score">
      insert into review_score values(null,
                                      #{ mem_idx },
                                      #{ performance_idx },
                                      #{ review_idx },
                                      #{ review_score_point }
                                      );
  </insert>

</mapper>